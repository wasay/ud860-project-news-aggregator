const appPrefix="mws-hacker-news",staticCacheName=appPrefix+"-v6",contentImgsCache=appPrefix+"-content-imgs",allCaches=[staticCacheName,contentImgsCache];let debug=!1;function servePhoto(e){debug&&console.log("sw-servePhoto()");let t=e.url.replace(/^(\d+-?)+\d+$\.jpg$/,"");return caches.open(contentImgsCache).then(function(s){return s.match(t).then(function(n){return debug&&console.log("cache match check"),n||(debug&&console.log("fetch request.url="+e.url),fetch(e).then(function(e){return debug&&console.log("response cache"),s.put(t,e.clone()),e}).catch(e=>(e.message=`Request failed serve request. Returned status of ${e.message}`,debug&&console.log("404 return placeholder.png"),caches.match("/images/placeholder.png"))))})}).catch(e=>{throw e.message=`Request failed serve photo. Returned status of ${e.message}`,e})}function serveRequest(e){debug&&console.log("sw-serveRequest()");let t=e.url;return caches.open(staticCacheName).then(function(s){return s.match(t).then(function(n){return debug&&console.log("cache match check"),n||(debug&&console.log("fetch request.url="+e.url),fetch(e).then(function(e){return debug&&console.log("response cache"),s.put(t,e.clone()),e}).catch(e=>(e.message=`Request failed serve request. Returned status of ${e.message}`,debug&&console.log("404 return index.html"),caches.match("/404.html"))))})}).catch(e=>{throw e.message=`Request failed serve request. Returned status of ${e.message}`,e})}function cleanCache(){return debug&&console.log("sw-cleanCache()"),caches.keys().then(function(e){return Promise.all(e.filter(function(e){return e.startsWith(appPrefix)&&!allCaches.includes(e)}).map(function(e){return caches.delete(e)}))}).catch(e=>{throw e.message=`Request failed clean cache. Returned status of ${e.message}`,e})}self.addEventListener("install",function(e){debug&&console.log("sw-install()"),self.skipWaiting(),e.waitUntil(caches.open(staticCacheName).then(function(e){return e.addAll(["/","images/icons/icon.png","images/icons/icon.svg","images/icons/icon192.png","images/icons/icon512.png","images/ic_close_24px.svg","images/loader.png","images/placeholder.png","scripts/app.min.js","scripts/sw-reg.min.js","styles/app.min.css","third_party/handlebars-intl.min.js","third_party/handlebars-v3.0.0.js","404.html","index.html","manifest.json","sw.js","robots.txt","https://fonts.googleapis.com/css?family=Roboto:400,500,700","https://fonts.gstatic.com/s/roboto/v18/KFOlCnqEu92Fr1MmEU9fBBc4AMP6lQ.woff2"])}).catch(e=>{throw e.message=`Request failed install. Returned status of ${e.message}`,e}))}),self.addEventListener("activate",function(e){debug&&console.log("sw-activate()"),e.waitUntil(cleanCache().catch(e=>(e.message=`Request failed activate. Returned status of ${e.message}`,!1)))}),self.addEventListener("fetch",function(e){debug&&console.log("sw-fetch()");const t=new URL(e.request.url);if(debug&&console.log("fetch requestUrl="+t),debug&&console.log("requestUrl.port="+t.port),debug&&console.log("requestUrl.origin="+t.origin),debug&&console.log("location.origin="+location.origin),t.origin===location.origin){if(debug&&console.log("requestUrl.pathname="+t.pathname),""===t.pathname||"/"===t.pathname)return void e.respondWith(caches.match("/index.html"));if(t.pathname.startsWith("images/")||t.pathname.startsWith("/img/"))return void e.respondWith(servePhoto(e.request))}debug&&console.log("other"),e.respondWith(serveRequest(e.request))});